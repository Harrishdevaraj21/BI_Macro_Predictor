<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BI-MACRO Predictor - Indian Bank Lending Rate Forecasting</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css" rel="stylesheet">
    <!-- Chart.js for visualizations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    
    <style>
        :root {
            --primary-blue: #0d47a1;
            --secondary-blue: #1976d2;
            --success-green: #2e7d32;
            --warning-orange: #f57c00;
            --info-purple: #7b1fa2;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        .navbar-custom {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .metric-card {
            transition: transform 0.2s, box-shadow 0.2s;
            border-left: 4px solid var(--secondary-blue);
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .prediction-result {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-left: 5px solid var(--success-green);
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        
        .btn-predict {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        .btn-predict:hover {
            transform: scale(1.05);
        }
        
        .form-range::-webkit-slider-thumb {
            background: var(--secondary-blue);
        }
        
        .form-range::-moz-range-thumb {
            background: var(--secondary-blue);
        }
        
        .insight-box {
            border-left: 4px solid;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .insight-box.blue { border-left-color: var(--secondary-blue); }
        .insight-box.green { border-left-color: var(--success-green); }
        .insight-box.orange { border-left-color: var(--warning-orange); }
        .insight-box.purple { border-left-color: var(--info-purple); }
        
        .upload-zone {
            border: 2px dashed #dee2e6;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            background-color: #fff;
        }
        
        .upload-zone:hover {
            border-color: var(--secondary-blue);
            background-color: #f0f7ff;
        }
        
        .upload-zone.active {
            border-color: var(--success-green);
            background-color: #e8f5e9;
        }
        
        .table-responsive {
            border-radius: 8px;
            overflow: hidden;
        }
        
        .hero-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 12px;
            border: 1px solid #90caf9;
        }
        
        .feature-item {
            display: flex;
            align-items: start;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }
        
        .model-architecture-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .performance-bar {
            height: 30px;
            border-radius: 15px;
            background-color: #e9ecef;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .performance-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-green) 0%, #66bb6a 100%);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: white;
            font-weight: bold;
            transition: width 1s ease-out;
        }
        
        .data-stat {
            text-align: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .sentiment-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .sentiment-positive {
            background-color: #c8e6c9;
            color: #2e7d32;
        }
        
        .sentiment-neutral {
            background-color: #fff9c4;
            color: #f57f17;
        }
        
        .sentiment-negative {
            background-color: #ffcdd2;
            color: #c62828;
        }
        
        @media (max-width: 768px) {
            .navbar-custom .navbar-brand {
                font-size: 1rem;
            }
            .metric-card {
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <i class="bi bi-graph-up-arrow fs-4 me-2"></i>
                <strong>BI-MACRO Predictor</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showTab(event, 'home')">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showTab(event, 'data')">Data</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showTab(event, 'model')">Model</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showTab(event, 'predictions')">Predictions</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showTab(event, 'insights')">Insights</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <div class="container-fluid py-4 px-3 px-md-4">
        <!-- Home Tab -->
        <div id="homeTab" class="tab-content-section">
            <!-- Hero Section -->
            <div class="hero-section p-4 p-md-5 mb-4">
                <h1 class="display-5 fw-bold text-dark mb-3">
                    AI-Powered Indian Bank Lending Rate Forecasting
                </h1>
                <p class="lead text-secondary mb-4">
                    Predict lending rates using macroeconomic indicators, RBI policy rates, and 
                    FinBERT-analyzed financial news sentiment. Built for precision and transparency.
                </p>
                <div class="row">
                    <div class="col-md-4">
                        <div class="feature-item">
                            <i class="bi bi-check-circle-fill text-success fs-4"></i>
                            <div>
                                <h5 class="mb-1">Real-time Analysis</h5>
                                <p class="text-muted small mb-0">Live macroeconomic data integration</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="feature-item">
                            <i class="bi bi-check-circle-fill text-success fs-4"></i>
                            <div>
                                <h5 class="mb-1">Sentiment Scoring</h5>
                                <p class="text-muted small mb-0">FinBERT-based news analysis</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="feature-item">
                            <i class="bi bi-check-circle-fill text-success fs-4"></i>
                            <div>
                                <h5 class="mb-1">High Accuracy</h5>
                                <p class="text-muted small mb-0">94% R² score on validation data</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Metric Cards -->
            <div class="row mb-4">
                <div class="col-md-4 mb-3">
                    <div class="card metric-card p-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="text-muted mb-0">Model Accuracy (R²)</h6>
                            <i class="bi bi-activity text-primary fs-4"></i>
                        </div>
                        <h2 class="fw-bold mb-0">0.94</h2>
                        <small class="text-success"><i class="bi bi-arrow-up"></i> Excellent fit</small>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card metric-card p-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="text-muted mb-0">Mean Absolute Error</h6>
                            <i class="bi bi-exclamation-circle text-warning fs-4"></i>
                        </div>
                        <h2 class="fw-bold mb-0">0.12%</h2>
                        <small class="text-success"><i class="bi bi-check-circle"></i> Low error rate</small>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card metric-card p-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="text-muted mb-0">RMSE</h6>
                            <i class="bi bi-bar-chart text-info fs-4"></i>
                        </div>
                        <h2 class="fw-bold mb-0">0.18%</h2>
                        <small class="text-success"><i class="bi bi-check-circle"></i> Reliable predictions</small>
                    </div>
                </div>
            </div>

            <!-- Historical Chart -->
            <div class="card p-4">
                <h4 class="mb-4"><i class="bi bi-graph-up me-2"></i>Historical RBI & Lending Rates</h4>
                <canvas id="historicalChart" height="80"></canvas>
            </div>
        </div>

        <!-- Data Tab -->
        <div id="dataTab" class="tab-content-section" style="display: none;">
            <div class="row">
                <div class="col-lg-8">
                    <!-- Upload Section -->
                    <div class="card p-4 mb-4">
                        <h4 class="mb-4">
                            <i class="bi bi-upload me-2 text-primary"></i>Dataset Upload & Management
                        </h4>
                        <div class="upload-zone" id="uploadZone" onclick="document.getElementById('csvUpload').click()">
                            <i class="bi bi-cloud-upload fs-1 text-muted mb-3 d-block"></i>
                            <p class="text-muted mb-2 fw-semibold" id="uploadText">Click to upload CSV dataset</p>
                            <small class="text-secondary">Expected columns: date, repoRate, inflation, gdp, crr, lendingRate</small>
                            <input type="file" id="csvUpload" accept=".csv" style="display: none;" onchange="handleFileUpload(event)">
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="downloadSampleCSV()">
                                <i class="bi bi-download me-1"></i>Download Sample CSV
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="clearUploadedData()">
                                <i class="bi bi-trash me-1"></i>Clear Data
                            </button>
                        </div>
                    </div>

                    <!-- Dataset Preview -->
                    <div class="card p-4 mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h4 class="mb-0"><i class="bi bi-table me-2 text-success"></i>Dataset Preview</h4>
                            <span class="badge bg-primary">Last 5 Entries</span>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover table-sm">
                                <thead class="table-light">
                                    <tr>
                                        <th><i class="bi bi-calendar3 me-1"></i>Date</th>
                                        <th><i class="bi bi-percent me-1"></i>Repo Rate</th>
                                        <th><i class="bi bi-graph-up me-1"></i>Inflation</th>
                                        <th><i class="bi bi-bar-chart me-1"></i>GDP Growth</th>
                                        <th><i class="bi bi-bank me-1"></i>CRR</th>
                                        <th><i class="bi bi-currency-rupee me-1"></i>Lending Rate</th>
                                    </tr>
                                </thead>
                                <tbody id="dataPreviewTable">
                                    <tr>
                                        <td>2024-01-01</td>
                                        <td><span class="badge bg-info">6.50%</span></td>
                                        <td><span class="badge bg-warning text-dark">5.10%</span></td>
                                        <td><span class="badge bg-success">7.60%</span></td>
                                        <td><span class="badge bg-secondary">4.50%</span></td>
                                        <td class="fw-bold text-primary">8.75%</td>
                                    </tr>
                                    <tr>
                                        <td>2024-02-01</td>
                                        <td><span class="badge bg-info">6.50%</span></td>
                                        <td><span class="badge bg-warning text-dark">5.09%</span></td>
                                        <td><span class="badge bg-success">7.80%</span></td>
                                        <td><span class="badge bg-secondary">4.50%</span></td>
                                        <td class="fw-bold text-primary">8.80%</td>
                                    </tr>
                                    <tr>
                                        <td>2024-03-01</td>
                                        <td><span class="badge bg-info">6.50%</span></td>
                                        <td><span class="badge bg-warning text-dark">4.85%</span></td>
                                        <td><span class="badge bg-success">7.90%</span></td>
                                        <td><span class="badge bg-secondary">4.50%</span></td>
                                        <td class="fw-bold text-primary">8.85%</td>
                                    </tr>
                                    <tr>
                                        <td>2024-04-01</td>
                                        <td><span class="badge bg-info">6.50%</span></td>
                                        <td><span class="badge bg-warning text-dark">4.83%</span></td>
                                        <td><span class="badge bg-success">8.20%</span></td>
                                        <td><span class="badge bg-secondary">4.50%</span></td>
                                        <td class="fw-bold text-primary">8.82%</td>
                                    </tr>
                                    <tr>
                                        <td>2024-05-01</td>
                                        <td><span class="badge bg-info">6.50%</span></td>
                                        <td><span class="badge bg-warning text-dark">4.75%</span></td>
                                        <td><span class="badge bg-success">8.10%</span></td>
                                        <td><span class="badge bg-secondary">4.50%</span></td>
                                        <td class="fw-bold text-primary">8.90%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <!-- Dataset Statistics -->
                    <div class="card p-4 mb-4">
                        <h5 class="mb-4"><i class="bi bi-pie-chart me-2 text-info"></i>Dataset Statistics</h5>
                        <div class="data-stat">
                            <h6 class="text-muted mb-1">Total Records</h6>
                            <h3 class="fw-bold text-primary mb-0">2,847</h3>
                        </div>
                        <div class="data-stat">
                            <h6 class="text-muted mb-1">Date Range</h6>
                            <p class="fw-semibold mb-0">Jan 2015 - Dec 2024</p>
                        </div>
                        <div class="data-stat">
                            <h6 class="text-muted mb-1">Data Quality</h6>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar bg-success" style="width: 98%">98%</div>
                            </div>
                        </div>
                        <div class="data-stat">
                            <h6 class="text-muted mb-1">Missing Values</h6>
                            <p class="fw-semibold mb-0 text-success">0.2% (57 cells)</p>
                        </div>
                    </div>

                    <!-- Data Sources -->
                    <div class="card p-4">
                        <h5 class="mb-3"><i class="bi bi-database me-2 text-warning"></i>Data Sources</h5>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="bi bi-check-circle-fill text-success me-2"></i>
                                <strong>RBI Database</strong>
                                <br><small class="text-muted ms-4">Policy rates & CRR</small>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check-circle-fill text-success me-2"></i>
                                <strong>MOSPI</strong>
                                <br><small class="text-muted ms-4">Inflation & GDP data</small>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check-circle-fill text-success me-2"></i>
                                <strong>Economic Times</strong>
                                <br><small class="text-muted ms-4">Financial news corpus</small>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check-circle-fill text-success me-2"></i>
                                <strong>Bank Websites</strong>
                                <br><small class="text-muted ms-4">Retail lending rates</small>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Sentiment Trends Section -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card p-4">
                        <h4 class="mb-4"><i class="bi bi-emoji-smile me-2 text-success"></i>News Sentiment Trends (FinBERT Analysis)</h4>
                        <canvas id="sentimentChart" height="80"></canvas>
                        <div class="alert alert-info mt-3 d-flex align-items-start">
                            <i class="bi bi-info-circle me-2 mt-1 fs-5"></i>
                            <div>
                                <strong>About Sentiment Analysis:</strong>
                                <p class="mb-0 small">Sentiment scores range from -1 (negative) to +1 (positive). Data analyzed from 500+ financial news articles using FinBERT transformer model. Positive sentiment often correlates with rate reduction expectations.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent News Sentiment -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card p-4">
                        <h5 class="mb-4"><i class="bi bi-newspaper me-2"></i>Recent News Sentiment Analysis</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="p-3 border rounded">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h6 class="mb-1">RBI maintains status quo on rates</h6>
                                        <span class="sentiment-badge sentiment-neutral">Neutral</span>
                                    </div>
                                    <small class="text-muted">Jan 5, 2026 | Score: 0.05</small>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="p-3 border rounded">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h6 class="mb-1">Inflation eases to 4.5%, fueling rate cut hopes</h6>
                                        <span class="sentiment-badge sentiment-positive">Positive</span>
                                    </div>
                                    <small class="text-muted">Jan 3, 2026 | Score: 0.78</small>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="p-3 border rounded">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h6 class="mb-1">GDP growth accelerates to 8.2%</h6>
                                        <span class="sentiment-badge sentiment-positive">Positive</span>
                                    </div>
                                    <small class="text-muted">Dec 30, 2025 | Score: 0.85</small>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="p-3 border rounded">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h6 class="mb-1">Global uncertainty impacts domestic outlook</h6>
                                        <span class="sentiment-badge sentiment-negative">Negative</span>
                                    </div>
                                    <small class="text-muted">Dec 28, 2025 | Score: -0.42</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Model Tab -->
        <div id="modelTab" class="tab-content-section" style="display: none;">
            <!-- Model Architecture Overview -->
            <div class="card p-4 mb-4">
                <h4 class="mb-4"><i class="bi bi-diagram-3 me-2 text-primary"></i>Model Architecture & Design</h4>
                
                <div class="model-architecture-box">
                    <h5 class="fw-bold mb-3"><i class="bi bi-layers text-primary me-2"></i>Ensemble Architecture</h5>
                    <p class="text-muted">The BI-MACRO Predictor uses a sophisticated ensemble approach combining three powerful machine learning algorithms to maximize prediction accuracy and robustness.</p>
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <div class="text-center p-3 bg-white rounded">
                                <i class="bi bi-tree fs-2 text-success"></i>
                                <h6 class="mt-2 fw-bold">Random Forest</h6>
                                <small class="text-muted">Weight: 30%</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3 bg-white rounded">
                                <i class="bi bi-lightning fs-2 text-warning"></i>
                                <h6 class="mt-2 fw-bold">XGBoost</h6>
                                <small class="text-muted">Weight: 40%</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3 bg-white rounded">
                                <i class="bi bi-distribute-vertical fs-2 text-info"></i>
                                <h6 class="mt-2 fw-bold">LSTM Network</h6>
                                <small class="text-muted">Weight: 30%</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="insight-box green mt-4">
                    <h5 class="fw-bold mb-2"><i class="bi bi-gear me-2"></i>Feature Engineering Pipeline</h5>
                    <p class="mb-2 text-muted">Advanced feature transformation to capture temporal patterns and cross-variable relationships:</p>
                    <ul class="mb-0 text-muted">
                        <li><strong>Primary Features (5):</strong> Repo Rate, Inflation, GDP Growth, CRR, Sentiment Score</li>
                        <li><strong>Lag Features (3):</strong> 1-month, 3-month, and 6-month historical lags</li>
                        <li><strong>Moving Averages (2):</strong> 3-month and 6-month rolling averages</li>
                        <li><strong>Interaction Terms (4):</strong> Repo×Inflation, GDP×Sentiment, etc.</li>
                    </ul>
                </div>

                <div class="insight-box purple">
                    <h5 class="fw-bold mb-2"><i class="bi bi-file-earmark-text me-2"></i>Sentiment Integration (FinBERT)</h5>
                    <p class="mb-0 text-muted">
                        FinBERT transformer model (fine-tuned BERT for financial text) analyzes RBI policy statements, 
                        central bank communications, and financial news to extract market sentiment. The sentiment score 
                        is normalized to [-1, 1] range and integrated as a key predictive feature.
                    </p>
                </div>
            </div>

            <div class="row">
                <!-- Training Configuration -->
                <div class="col-lg-6 mb-4">
                    <div class="card p-4 h-100">
                        <h5 class="mb-4"><i class="bi bi-sliders text-success me-2"></i>Training Configuration</h5>
                        <table class="table table-sm">
                            <tbody>
                                <tr>
                                    <td class="text-muted">Training Samples</td>
                                    <td class="text-end fw-bold">2,847</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">Validation Split</td>
                                    <td class="text-end fw-bold">20% (570 samples)</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">Test Split</td>
                                    <td class="text-end fw-bold">15% (427 samples)</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">Training Epochs</td>
                                    <td class="text-end fw-bold">150</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">Learning Rate</td>
                                    <td class="text-end fw-bold">0.001</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">Batch Size</td>
                                    <td class="text-end fw-bold">32</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">Optimization</td>
                                    <td class="text-end fw-bold">Adam + L2 Reg</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">Cross-Validation</td>
                                    <td class="text-end fw-bold">5-Fold CV</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="col-lg-6 mb-4">
                    <div class="card p-4 h-100">
                        <h5 class="mb-4"><i class="bi bi-trophy text-warning me-2"></i>Model Performance</h5>
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">R² Score (Coefficient of Determination)</span>
                                <strong class="text-success">0.94</strong>
                            </div>
                            <div class="performance-bar">
                                <div class="performance-fill" style="width: 94%">94%</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">Mean Absolute Error (MAE)</span>
                                <strong class="text-primary">0.12%</strong>
                            </div>
                            <small class="text-muted">Average prediction error magnitude</small>
                        </div>

                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">Root Mean Squared Error (RMSE)</span>
                                <strong class="text-info">0.18%</strong>
                            </div>
                            <small class="text-muted">Penalizes larger errors more heavily</small>
                        </div>

                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">Mean Absolute Percentage Error</span>
                                <strong class="text-warning">1.35%</strong>
                            </div>
                            <small class="text-muted">Average percentage deviation</small>
                        </div>

                        <div class="alert alert-success mt-3 mb-0">
                            <small><i class="bi bi-check-circle me-1"></i>Model exceeds industry benchmarks for financial forecasting</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feature Importance -->
            <div class="card p-4 mb-4">
                <h5 class="mb-4"><i class="bi bi-bar-chart-steps text-info me-2"></i>Feature Importance Analysis</h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="text-muted small mb-1">Repo Rate</label>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-primary" style="width: 45%">45%</div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted small mb-1">Inflation Rate</label>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-warning" style="width: 22%">22%</div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted small mb-1">News Sentiment</label>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-success" style="width: 18%">18%</div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted small mb-1">GDP Growth</label>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-info" style="width: 10%">10%</div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted small mb-1">CRR</label>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-secondary" style="width: 5%">5%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Model Validation -->
            <div class="card p-4">
                <h5 class="mb-4"><i class="bi bi-shield-check text-success me-2"></i>Validation & Testing</h5>
                <div class="row">
                    <div class="col-md-4">
                        <div class="stats-card text-center">
                            <h6 class="text-muted">Training Accuracy</h6>
                            <h3 class="fw-bold text-success">96.2%</h3>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stats-card text-center">
                            <h6 class="text-muted">Validation Accuracy</h6>
                            <h3 class="fw-bold text-primary">94.0%</h3>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stats-card text-center">
                            <h6 class="text-muted">Test Accuracy</h6>
                            <h3 class="fw-bold text-info">93.8%</h3>
                        </div>
                    </div>
                </div>
                <div class="alert alert-info mt-3 mb-0">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>Model Robustness:</strong> Minimal overfitting detected. Consistent performance across train/validation/test sets indicates good generalization.
                </div>
            </div>
        </div>

        <!-- Predictions Tab -->
        <div id="predictionsTab" class="tab-content-section" style="display: none;">
            <div class="row">
                <div class="col-lg-8">
                    <div class="card p-4 mb-4">
                        <h4 class="mb-4"><i class="bi bi-calculator me-2 text-primary"></i>Input Macroeconomic Variables</h4>
                        <form id="predictionForm">
                            <div class="row">
                                <!-- Repo Rate -->
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">
                                        <i class="bi bi-percent me-1"></i>Repo Rate (%)
                                    </label>
                                    <input type="number" class="form-control form-control-lg" id="repoRate" value="6.50" step="0.01" min="0" max="15" required>
                                    <small class="text-muted">Current RBI policy rate</small>
                                </div>

                                <!-- Inflation Rate -->
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">
                                        <i class="bi bi-graph-up me-1"></i>Inflation Rate (%)
                                    </label>
                                    <input type="number" class="form-control form-control-lg" id="inflationRate" value="5.10" step="0.01" min="-5" max="20" required>
                                    <small class="text-muted">CPI-based inflation rate</small>
                                </div>

                                <!-- GDP Growth -->
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">
                                        <i class="bi bi-bar-chart me-1"></i>GDP Growth (%)
                                    </label>
                                    <input type="number" class="form-control form-control-lg" id="gdpGrowth" value="7.60" step="0.01" min="-10" max="20" required>
                                    <small class="text-muted">Quarterly GDP growth rate</small>
                                </div>

                                <!-- CRR -->
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">
                                        <i class="bi bi-bank me-1"></i>Cash Reserve Ratio (%)
                                    </label>
                                    <input type="number" class="form-control form-control-lg" id="crr" value="4.50" step="0.01" min="0" max="20" required>
                                    <small class="text-muted">Bank reserve requirement</small>
                                </div>

                                <!-- Sentiment Score -->
                                <div class="col-12 mb-4">
                                    <label class="form-label fw-semibold">
                                        <i class="bi bi-emoji-smile me-1"></i>News Sentiment Score (-1 to +1)
                                    </label>
                                    <div class="d-flex align-items-center gap-3">
                                        <span class="text-muted small">Negative</span>
                                        <input type="range" class="form-range flex-grow-1" id="sentimentScore" min="-1" max="1" step="0.01" value="0.65" oninput="updateSentimentValue(this.value)">
                                        <span class="text-muted small">Positive</span>
                                        <span class="badge bg-primary fs-6" id="sentimentValue" style="min-width: 70px;">0.65</span>
                                    </div>
                                    <small class="text-muted">FinBERT-analyzed market sentiment</small>
                                </div>
                            </div>

                            <button type="button" class="btn btn-primary btn-predict btn-lg w-100" onclick="predictLendingRate()">
                                <i class="bi bi-cpu me-2"></i>
                                <span id="predictButtonText">Predict Lending Rate</span>
                                <span id="predictButtonSpinner" class="spinner-border spinner-border-sm ms-2" style="display: none;"></span>
                            </button>
                        </form>
                    </div>

                    <!-- Prediction Results -->
                    <div id="predictionResults" class="card prediction-result p-4" style="display: none;">
                        <h4 class="mb-4"><i class="bi bi-clipboard-data me-2"></i>Prediction Results</h4>
                        
                        <div class="card bg-white p-4 mb-4 text-center shadow-sm">
                            <p class="text-muted mb-2 text-uppercase small">Predicted Bank Lending Rate</p>
                            <h1 class="display-2 fw-bold text-success mb-2" id="predictedRate">--</h1>
                            <p class="text-muted mb-0">
                                <i class="bi bi-shield-check me-1"></i>Model Confidence: <strong id="modelConfidence">--</strong>
                            </p>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="card bg-white p-4 h-100">
                                    <h5 class="mb-3"><i class="bi bi-pie-chart me-2 text-primary"></i>Factor Contributions</h5>
                                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                                        <div>
                                            <i class="bi bi-circle-fill text-primary me-2"></i>
                                            <span class="text-muted">Repo Rate Impact</span>
                                        </div>
                                        <strong class="text-primary fs-5" id="repoImpact">--</strong>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                                        <div>
                                            <i class="bi bi-circle-fill text-warning me-2"></i>
                                            <span class="text-muted">Inflation Impact</span>
                                        </div>
                                        <strong class="text-warning fs-5" id="inflationImpact">--</strong>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                                        <div>
                                            <i class="bi bi-circle-fill text-info me-2"></i>
                                            <span class="text-muted">GDP Impact</span>
                                        </div>
                                        <strong class="text-info fs-5" id="gdpImpact">--</strong>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <i class="bi bi-circle-fill text-success me-2"></i>
                                            <span class="text-muted">Sentiment Impact</span>
                                        </div>
                                        <strong class="text-success fs-5" id="sentimentImpact">--</strong>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="card bg-white p-4 h-100">
                                    <h5 class="mb-3"><i class="bi bi-lightbulb me-2 text-warning"></i>AI Interpretation</h5>
                                    <p class="text-muted" id="interpretationText" style="line-height: 1.8;">--</p>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info mt-3">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Recommendation:</strong> <span id="recommendationText">Monitor RBI policy announcements and macroeconomic indicators for any significant changes that may affect this prediction.</span>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <!-- Quick Presets -->
                    <div class="card p-4 mb-4">
                        <h5 class="mb-3"><i class="bi bi-stars text-warning me-2"></i>Quick Presets</h5>
                        <p class="text-muted small">Load pre-configured scenarios</p>
                        
                        <button class="btn btn-outline-primary w-100 mb-2" onclick="loadPreset('current')">
                            <i class="bi bi-calendar-check me-2"></i>Current Scenario
                        </button>
                        <button class="btn btn-outline-success w-100 mb-2" onclick="loadPreset('optimistic')">
                            <i class="bi bi-graph-up-arrow me-2"></i>Optimistic Growth
                        </button>
                        <button class="btn btn-outline-warning w-100 mb-2" onclick="loadPreset('cautious')">
                            <i class="bi bi-exclamation-triangle me-2"></i>Cautious Outlook
                        </button>
                        <button class="btn btn-outline-danger w-100" onclick="loadPreset('crisis')">
                            <i class="bi bi-shield-exclamation me-2"></i>Economic Stress
                        </button>
                    </div>

                    <!-- Prediction History -->
                    <div class="card p-4">
                        <h5 class="mb-3"><i class="bi bi-clock-history text-info me-2"></i>Recent Predictions</h5>
                        <div id="predictionHistory">
                            <p class="text-muted small text-center">No predictions yet. Run your first prediction above.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Insights Tab -->
        <div id="insightsTab" class="tab-content-section" style="display: none;">
            <div class="card p-4 mb-4">
                <h4 class="mb-4"><i class="bi bi-lightbulb me-2 text-warning"></i>Key Insights & Market Intelligence</h4>
                
                <div class="insight-box blue">
                    <h5 class="fw-bold mb-2"><i class="bi bi-graph-up me-2"></i>Repo Rate Correlation & Transmission Lag</h5>
                    <p class="text-muted mb-2">
                        Historical analysis reveals an <strong>85% correlation</strong> between RBI repo rate changes and bank lending rates. 
                        The transmission mechanism typically operates with a lag of <strong>30-45 days</strong> for retail lending rates.
                    </p>
                    <ul class="text-muted mb-0 small">
                        <li>Home loans: 35-40 day average transmission lag</li>
                        <li>Personal loans: 25-30 day average transmission lag</li>
                        <li>Business loans: 40-50 day average transmission lag</li>
                    </ul>
                </div>

                <div class="insight-box green">
                    <h5 class="fw-bold mb-2"><i class="bi bi-emoji-smile me-2"></i>Sentiment Analysis Impact on Rate Expectations</h5>
                    <p class="text-muted mb-2">
                        Positive financial news sentiment (FinBERT score > 0.6) historically precedes lending rate reductions by 
                        <strong>2-3 months</strong>, while sustained negative sentiment (score < -0.3) often signals policy tightening.
                    </p>
                    <div class="row mt-2">
                        <div class="col-6">
                            <small class="text-muted d-block">Avg Rate Change (Positive Sentiment)</small>
                            <strong class="text-success">-0.25% to -0.40%</strong>
                        </div>
                        <div class="col-6">
                            <small class="text-muted d-block">Avg Rate Change (Negative Sentiment)</small>
                            <strong class="text-danger">+0.30% to +0.50%</strong>
                        </div>
                    </div>
                </div>

                <div class="insight-box orange">
                    <h5 class="fw-bold mb-2"><i class="bi bi-thermometer-half me-2"></i>Inflation Threshold & RBI Mandate</h5>
                    <p class="text-muted mb-2">
                        When inflation exceeds <strong>6% (RBI's upper tolerance limit)</strong>, lending rates typically increase by 
                        0.25-0.50% within the next quarter as banks adjust their base rates to maintain real returns.
                    </p>
                    <div class="alert alert-warning mb-0 small">
                        <i class="bi bi-exclamation-triangle me-1"></i>
                        The RBI's inflation targeting framework mandates keeping CPI inflation at 4% ± 2%. Breaching these bounds 
                        triggers monetary policy action with high probability.
                    </div>
                </div>

                <div class="insight-box purple">
                    <h5 class="fw-bold mb-2"><i class="bi bi-bar-chart-line me-2"></i>GDP Growth Dynamics & Competitive Pressure</h5>
                    <p class="text-muted mb-2">
                        Strong GDP growth (>7.5%) creates competitive pressure among banks, often leading to marginal reductions 
                        in lending spreads (0.10-0.20%) as financial institutions compete for market share in an expanding economy.
                    </p>
                    <p class="text-muted mb-0 small">
                        Conversely, GDP slowdown (<6%) typically results in risk aversion, causing banks to widen spreads by 
                        0.15-0.30% to compensate for increased credit risk.
                    </p>
                </div>

                <div class="insight-box blue">
                    <h5 class="fw-bold mb-2"><i class="bi bi-bank me-2"></i>CRR Policy Transmission Mechanism</h5>
                    <p class="text-muted mb-0">
                        Cash Reserve Ratio adjustments impact bank liquidity directly. A <strong>0.25% CRR increase</strong> 
                        typically translates to a <strong>0.10-0.15% lending rate increase</strong> within 2-3 weeks as banks 
                        adjust to reduced lendable funds. The effect is immediate for new loans but gradually applies to 
                        existing floating-rate loans.
                    </p>
                </div>

                <div class="insight-box green">
                    <h5 class="fw-bold mb-2"><i class="bi bi-calendar-range me-2"></i>Forecast Reliability & Time Horizons</h5>
                    <p class="text-muted mb-2">
                        The BI-MACRO model's predictions are most reliable for <strong>1-3 month horizons</strong> with 94% accuracy. 
                        For longer-term forecasts (6-12 months), accuracy decreases to approximately 78-82% due to increased 
                        uncertainty in macroeconomic variables.
                    </p>
                    <div class="table-responsive">
                        <table class="table table-sm small">
                            <thead class="table-light">
                                <tr>
                                    <th>Forecast Horizon</th>
                                    <th>Typical R²</th>
                                    <th>Recommendation</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1 Month</td>
                                    <td><span class="badge bg-success">0.94</span></td>
                                    <td>Highly reliable</td>
                                </tr>
                                <tr>
                                    <td>3 Months</td>
                                    <td><span class="badge bg-success">0.89</span></td>
                                    <td>Reliable with monitoring</td>
                                </tr>
                                <tr>
                                    <td>6 Months</td>
                                    <td><span class="badge bg-warning text-dark">0.82</span></td>
                                    <td>Update inputs monthly</td>
                                </tr>
                                <tr>
                                    <td>12 Months</td>
                                    <td><span class="badge bg-danger">0.75</span></td>
                                    <td>Use as directional guide only</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Market Outlook -->
            <div class="card p-4 mb-4">
                <h5 class="mb-4"><i class="bi bi-compass me-2 text-primary"></i>Current Market Outlook (January 2026)</h5>
                <div class="row">
                    <div class="col-md-6">
                        <div class="p-3 bg-light rounded mb-3">
                            <h6 class="fw-bold"><i class="bi bi-arrow-down-circle text-success me-2"></i>Positive Factors</h6>
                            <ul class="mb-0 small text-muted">
                                <li>Inflation trending downward toward RBI target</li>
                                <li>Strong GDP growth momentum (8%+ expected)</li>
                                <li>Positive market sentiment from global stability</li>
                                <li>Increased foreign investment inflows</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="p-3 bg-light rounded mb-3">
                            <h6 class="fw-bold"><i class="bi bi-arrow-up-circle text-danger me-2"></i>Risk Factors</h6>
                            <ul class="mb-0 small text-muted">
                                <li>Global geopolitical uncertainties</li>
                                <li>Crude oil price volatility</li>
                                <li>Potential fiscal slippage concerns</li>
                                <li>Monsoon dependency for agricultural growth</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actionable Recommendations -->
            <div class="card p-4">
                <h5 class="mb-4"><i class="bi bi-list-check me-2 text-success"></i>Actionable Recommendations</h5>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="p-3 border rounded h-100">
                            <h6 class="fw-bold text-primary"><i class="bi bi-people me-2"></i>For Borrowers</h6>
                            <ul class="small text-muted mb-0">
                                <li>Lock fixed rates if expecting rate hikes</li>
                                <li>Consider refinancing during rate cuts</li>
                                <li>Monitor RBI policy dates closely</li>
                                <li>Negotiate spreads during growth periods</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="p-3 border rounded h-100">
                            <h6 class="fw-bold text-success"><i class="bi bi-building me-2"></i>For Banks</h6>
                            <ul class="small text-muted mb-0">
                                <li>Adjust pricing models with sentiment data</li>
                                <li>Optimize liquidity ahead of CRR changes</li>
                                <li>Review credit policies during volatility</li>
                                <li>Enhance digital lending for competitiveness</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="p-3 border rounded h-100">
                            <h6 class="fw-bold text-info"><i class="bi bi-graph-up me-2"></i>For Investors</h6>
                            <ul class="small text-muted mb-0">
                                <li>Monitor rate forecasts for bond strategy</li>
                                <li>Use predictions for sector rotation</li>
                                <li>Track sentiment for market timing</li>
                                <li>Hedge interest rate risk appropriately</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

    <script>
        /**
         * Application State Management
         */
        const appState = {
            currentTab: 'home',
            uploadedFile: null,
            charts: {},
            predictionHistory: []
        };

        /**
         * Initialize application on page load
         */
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            showTab(null, 'home');
        });

        /**
         * Initialize all Chart.js visualizations
         */
        function initializeCharts() {
            // Historical RBI Rates Chart
            const historicalCtx = document.getElementById('historicalChart').getContext('2d');
            appState.charts.historical = new Chart(historicalCtx, {
                type: 'line',
                data: {
                    labels: ['Jan 24', 'Feb 24', 'Mar 24', 'Apr 24', 'May 24', 'Jun 24', 'Jul 24', 'Aug 24', 'Sep 24', 'Oct 24', 'Nov 24', 'Dec 24'],
                    datasets: [{
                        label: 'Repo Rate %',
                        data: [6.50, 6.50, 6.50, 6.50, 6.50, 6.50, 6.50, 6.50, 6.50, 6.50, 6.50, 6.50],
                        borderColor: '#1976d2',
                        backgroundColor: 'rgba(25, 118, 210, 0.1)',
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }, {
                        label: 'Lending Rate %',
                        data: [8.75, 8.80, 8.85, 8.82, 8.90, 8.95, 9.00, 9.05, 9.10, 9.12, 9.15, 9.20],
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 13, weight: 'bold' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            padding: 12,
                            titleFont: { size: 14 },
                            bodyFont: { size: 13 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 6,
                            max: 10,
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });

            // Sentiment Trend Chart
            const sentimentCtx = document.getElementById('sentimentChart').getContext('2d');
            appState.charts.sentiment = new Chart(sentimentCtx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7', 'Week 8'],
                    datasets: [{
                        label: 'Sentiment Score',
                        data: [0.65, 0.58, 0.72, 0.55, 0.68, 0.75, 0.62, 0.70],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 13, weight: 'bold' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            padding: 12
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 0,
                            max: 1,
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        /**
         * Show/hide tabs based on navigation
         */
        function showTab(event, tabName) {
            if (event) event.preventDefault();

            // Hide all tabs
            const tabs = ['homeTab', 'dataTab', 'modelTab', 'predictionsTab', 'insightsTab'];
            tabs.forEach(tab => {
                document.getElementById(tab).style.display = 'none';
            });

            // Show selected tab
            const tabMap = {
                'home': 'homeTab',
                'data': 'dataTab',
                'model': 'modelTab',
                'predictions': 'predictionsTab',
                'insights': 'insightsTab'
            };
            document.getElementById(tabMap[tabName]).style.display = 'block';

            // Update navigation active state
            document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            if (event) {
                event.target.classList.add('active');
            } else {
                // Initial load
                document.querySelector('.navbar-nav .nav-link').classList.add('active');
            }

            appState.currentTab = tabName;

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        /**
         * Update sentiment value display
         */
        function updateSentimentValue(value) {
            const formatted = parseFloat(value).toFixed(2);
            document.getElementById('sentimentValue').textContent = formatted;
            
            // Update badge color based on sentiment
            const badge = document.getElementById('sentimentValue');
            badge.classList.remove('bg-primary', 'bg-success', 'bg-warning', 'bg-danger');
            if (value > 0.5) {
                badge.classList.add('bg-success');
            } else if (value > 0) {
                badge.classList.add('bg-primary');
            } else if (value > -0.5) {
                badge.classList.add('bg-warning');
            } else {
                badge.classList.add('bg-danger');
            }
        }

        /**
         * Handle CSV file upload
         */
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                appState.uploadedFile = file;
                document.getElementById('uploadText').textContent = '✓ ' + file.name;
                document.getElementById('uploadZone').classList.add('active');
                
                // In production, parse CSV using FileReader API or Papa Parse library
                // For now, we show success feedback
                setTimeout(() => {
                    alert('CSV uploaded successfully! In production, this would parse and validate your data.');
                }, 300);
            }
        }

        /**
         * Download sample CSV template
         */
        function downloadSampleCSV() {
            const csvContent = "data:text/csv;charset=utf-8," + 
                "date,repoRate,inflation,gdp,crr,lendingRate\n" +
                "2024-01-01,6.50,5.10,7.60,4.50,8.75\n" +
                "2024-02-01,6.50,5.09,7.80,4.50,8.80\n" +
                "2024-03-01,6.50,4.85,7.90,4.50,8.85";
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "bi_macro_sample_data.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        /**
         * Clear uploaded data
         */
        function clearUploadedData() {
            appState.uploadedFile = null;
            document.getElementById('uploadText').textContent = 'Click to upload CSV dataset';
            document.getElementById('uploadZone').classList.remove('active');
            document.getElementById('csvUpload').value = '';
        }

        /**
         * Load preset scenarios for quick testing
         */
        function loadPreset(scenario) {
            const presets = {
                current: {
                    repoRate: 6.50,
                    inflationRate: 5.10,
                    gdpGrowth: 7.60,
                    crr: 4.50,
                    sentimentScore: 0.65
                },
                optimistic: {
                    repoRate: 6.25,
                    inflationRate: 4.20,
                    gdpGrowth: 8.50,
                    crr: 4.25,
                    sentimentScore: 0.85
                },
                cautious: {
                    repoRate: 6.75,
                    inflationRate: 5.80,
                    gdpGrowth: 6.80,
                    crr: 4.75,
                    sentimentScore: 0.25
                },
                crisis: {
                    repoRate: 7.50,
                    inflationRate: 7.20,
                    gdpGrowth: 4.50,
                    crr: 5.50,
                    sentimentScore: -0.65
                }
            };

            const preset = presets[scenario];
            if (preset) {
                document.getElementById('repoRate').value = preset.repoRate;
                document.getElementById('inflationRate').value = preset.inflationRate;
                document.getElementById('gdpGrowth').value = preset.gdpGrowth;
                document.getElementById('crr').value = preset.crr;
                document.getElementById('sentimentScore').value = preset.sentimentScore;
                updateSentimentValue(preset.sentimentScore);
            }
        }

        /**
         * Predict lending rate using placeholder ML logic
         * In production, this would call a backend ML model API endpoint
         */
        function predictLendingRate() {
            // Get input values
            const repoRate = parseFloat(document.getElementById('repoRate').value);
            const inflationRate = parseFloat(document.getElementById('inflationRate').value);
            const gdpGrowth = parseFloat(document.getElementById('gdpGrowth').value);
            const crr = parseFloat(document.getElementById('crr').value);
            const sentimentScore = parseFloat(document.getElementById('sentimentScore').value);

            // Validate inputs
            if (isNaN(repoRate) || isNaN(inflationRate) || isNaN(gdpGrowth) || isNaN(crr) || isNaN(sentimentScore)) {
                alert('Please fill in all input fields with valid numbers.');
                return;
            }

            // Show loading state
            document.getElementById('predictButtonText').textContent = 'Predicting...';
            document.getElementById('predictButtonSpinner').style.display = 'inline-block';
            document.querySelector('.btn-predict').disabled = true;

            // Simulate API call with timeout
            setTimeout(() => {
                // Placeholder prediction logic - weighted linear combination
                // In production, replace with actual ML model API call
                const baseLendingRate = 8.0;
                const repoWeight = 0.85;
                const inflationWeight = 0.15;
                const gdpWeight = -0.05;
                const crrWeight = 0.10;
                const sentimentWeight = -0.30;

                const predictedRate = baseLendingRate + 
                    (repoRate * repoWeight) +
                    (inflationRate * inflationWeight) +
                    (gdpGrowth * gdpWeight) +
                    (crr * crrWeight) +
                    (sentimentScore * sentimentWeight);

                const confidence = 0.92;

                // Calculate factor impacts as percentage contributions
                const totalImpact = Math.abs(repoRate * repoWeight) + 
                                   Math.abs(inflationRate * inflationWeight) + 
                                   Math.abs(gdpGrowth * gdpWeight) + 
                                   Math.abs(crr * crrWeight) + 
                                   Math.abs(sentimentScore * sentimentWeight);

                const repoImpact = (Math.abs(repoRate * repoWeight) / totalImpact * 100).toFixed(1);
                const inflationImpact = (Math.abs(inflationRate * inflationWeight) / totalImpact * 100).toFixed(1);
                const gdpImpact = (Math.abs(gdpGrowth * gdpWeight) / totalImpact * 100).toFixed(1);
                const sentimentImpact = (Math.abs(sentimentScore * sentimentWeight) / totalImpact * 100).toFixed(1);

                // Display results
                document.getElementById('predictedRate').textContent = predictedRate.toFixed(2) + '%';
                document.getElementById('modelConfidence').textContent = (confidence * 100).toFixed(0) + '%';
                document.getElementById('repoImpact').textContent = repoImpact + '%';
                document.getElementById('inflationImpact').textContent = inflationImpact + '%';
                document.getElementById('gdpImpact').textContent = gdpImpact + '%';
                document.getElementById('sentimentImpact').textContent = sentimentImpact + '%';

                // Generate interpretation based on inputs
                const sentimentText = sentimentScore > 0 ? 'positive' : 'negative';
                const sentimentEffect = sentimentScore > 0 ? 'slightly reduces' : 'slightly increases';
                const inflationStatus = inflationRate > 6 ? 'elevated inflation may trigger policy tightening' : 
                                       inflationRate < 4 ? 'low inflation provides room for rate cuts' : 
                                       'inflation remains within RBI target band';
                
                const interpretation = `The predicted lending rate of <strong>${predictedRate.toFixed(2)}%</strong> is primarily driven by the current repo rate of ${repoRate}%. Market analysis shows ${sentimentText} sentiment (${sentimentScore.toFixed(2)}), which ${sentimentEffect} the expected lending rate. ${inflationStatus.charAt(0).toUpperCase() + inflationStatus.slice(1)}. GDP growth at ${gdpGrowth}% ${gdpGrowth > 7.5 ? 'indicates strong economic expansion' : 'suggests moderate growth momentum'}.`;
                
                document.getElementById('interpretationText').innerHTML = interpretation;

                // Generate recommendation
                let recommendation = '';
                if (predictedRate < 8.5) {
                    recommendation = 'Favorable borrowing conditions expected. Consider locking in rates for long-term loans.';
                } else if (predictedRate > 9.5) {
                    recommendation = 'Higher lending rates anticipated. Borrowers may want to wait for potential rate cuts or negotiate better terms.';
                } else {
                    recommendation = 'Moderate lending rates expected. Monitor RBI policy announcements and macroeconomic indicators for any significant changes.';
                }
                document.getElementById('recommendationText').textContent = recommendation;

                // Show results section with animation
                const resultsDiv = document.getElementById('predictionResults');
                resultsDiv.style.display = 'block';

                // Add to prediction history
                addToPredictionHistory(predictedRate.toFixed(2), confidence);

                // Scroll to results
                setTimeout(() => {
                    resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);

                // Reset button state
                document.getElementById('predictButtonText').textContent = 'Predict Lending Rate';
                document.getElementById('predictButtonSpinner').style.display = 'none';
                document.querySelector('.btn-predict').disabled = false;
            }, 1200);
        }

        /**
         * Add prediction to history
         */
        function addToPredictionHistory(rate, confidence) {
            const timestamp = new Date().toLocaleString();
            const historyItem = {
                rate: rate,
                confidence: (confidence * 100).toFixed(0),
                timestamp: timestamp
            };

            appState.predictionHistory.unshift(historyItem);
            
            // Keep only last 5 predictions
            if (appState.predictionHistory.length > 5) {
                appState.predictionHistory.pop();
            }

            // Update history display
            const historyDiv = document.getElementById('predictionHistory');
            if (appState.predictionHistory.length > 0) {
                historyDiv.innerHTML = appState.predictionHistory.map((item, index) => `
                    <div class="p-2 border-bottom ${index === 0 ? 'bg-light' : ''}">
                        <div class="d-flex justify-content-between align-items-center">
                            <strong class="text-success">${item.rate}%</strong>
                            <small class="text-muted">${item.confidence}% conf.</small>
                        </div>
                        <small class="text-muted d-block">${item.timestamp}</small>
                    </div>
                `).join('');
            }
        }

        /**
         * Initialize tooltips (Bootstrap 5)
         */
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    </script>
</body>
</html>